<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheraFlow - Perfil</title>
    <link rel="stylesheet" href="styles/common.css">
    <style>
        /* Estilos espec√≠ficos da p√°gina Perfil */
        .header {
            text-align: center;
            padding: 30px 20px;
        }

        .header .avatar {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .header .avatar:hover {
            transform: scale(1.05);
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-row .label {
            color: #666;
            font-size: 0.95em;
        }

        .info-row .value {
            color: #333;
            font-weight: 500;
        }

        .plan-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .plan-card .label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .plan-card .plan-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .plan-card .features {
            font-size: 0.9em;
            line-height: 1.8;
        }

        .upgrade-btn {
            width: 100%;
            padding: 15px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #f9f9f9;
            margin: 0 -20px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .menu-item .left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-item .icon {
            font-size: 1.3em;
        }

        .menu-item .text {
            color: #333;
        }

        .menu-item .arrow {
            color: #ccc;
        }

        .logout-btn {
            width: 100%;
            padding: 15px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 1.8em;
            font-weight: bold;
        }

        .stat-box .label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .service-list {
            max-height: 250px;
            overflow-y: auto;
        }

        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .service-item .service-name {
            font-weight: 500;
        }

        .service-item .service-value {
            color: #667eea;
            font-weight: 600;
        }

        .service-item .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.2em;
        }

        .add-service-btn {
            width: 100%;
            padding: 12px;
            background: #f0f0f0;
            border: 2px dashed #ccc;
            border-radius: 8px;
            color: #666;
            cursor: pointer;
            margin-top: 10px;
        }

        .add-service-btn:hover {
            background: #e8e8e8;
            border-color: #667eea;
            color: #667eea;
        }

        .danger-zone {
            border: 1px solid #fee2e2;
            background: #fef2f2;
        }

        .danger-zone .section-title {
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="avatar" id="userAvatar" onclick="showEditProfileModal()">üíÜ</div>
        <h1 id="userName">Carregando...</h1>
        <p id="userEmail">-</p>
    </div>

    <div class="container">
        <div class="plan-card">
            <div class="label">Plano Atual</div>
            <div class="plan-name" id="planName">Gratuito ‚ú®</div>
            <div class="features" id="planFeatures">
                ‚úì At√© 5 clientes<br>
                ‚úì Agenda completa<br>
                ‚úì Controle financeiro b√°sico<br>
                ‚úó Sem pacotes de sess√µes
            </div>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="number" id="statClients">0</div>
                    <div class="label">Clientes</div>
                </div>
                <div class="stat-box">
                    <div class="number" id="statSessions">0</div>
                    <div class="label">Sess√µes/m√™s</div>
                </div>
            </div>
            <!-- Barra de Progresso do Limite -->
            <div id="limitProgress" style="margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px;">
                    <span>Uso do plano</span>
                    <span id="limitText">0/5 clientes</span>
                </div>
                <div style="background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px;">
                    <div id="limitBar" style="background: white; height: 100%; border-radius: 4px; width: 0%; transition: width 0.3s;"></div>
                </div>
            </div>
        </div>

        <button class="upgrade-btn" onclick="showPlansModal()">
            Ver Planos e Benef√≠cios üöÄ
        </button>

        <div class="section" style="margin-top: 30px;" id="profileInfo">
            <div class="section-title">üìã Informa√ß√µes</div>
            <div id="infoContent">Carregando...</div>
        </div>

        <div class="section">
            <div class="section-title">‚öôÔ∏è Configura√ß√µes</div>
            
            <div class="menu-item" onclick="showEditProfileModal()">
                <div class="left">
                    <span class="icon">‚úèÔ∏è</span>
                    <span class="text">Editar Perfil</span>
                </div>
                <span class="arrow">‚Ä∫</span>
            </div>

            <div class="menu-item" onclick="showServicesModal()">
                <div class="left">
                    <span class="icon">üíÜ</span>
                    <span class="text">Meus Servi√ßos</span>
                </div>
                <span class="arrow">‚Ä∫</span>
            </div>

            <div class="menu-item" onclick="showNotificationsModal()">
                <div class="left">
                    <span class="icon">üîî</span>
                    <span class="text">Notifica√ß√µes</span>
                </div>
                <span class="arrow">‚Ä∫</span>
            </div>

            <div class="menu-item" onclick="showBackupModal()">
                <div class="left">
                    <span class="icon">üíæ</span>
                    <span class="text">Backup de Dados</span>
                </div>
                <span class="arrow">‚Ä∫</span>
            </div>

            <div class="menu-item" onclick="showAboutModal()">
                <div class="left">
                    <span class="icon">‚ÑπÔ∏è</span>
                    <span class="text">Sobre o App</span>
                </div>
                <span class="arrow">‚Ä∫</span>
            </div>
        </div>

        <div class="section danger-zone">
            <div class="section-title">‚ö†Ô∏è Zona de Perigo</div>
            
            <div class="menu-item" onclick="resetData()">
                <div class="left">
                    <span class="icon">üóëÔ∏è</span>
                    <span class="text" style="color: #dc2626;">Limpar Todos os Dados</span>
                </div>
                <span class="arrow">‚Ä∫</span>
            </div>
        </div>

        <button class="logout-btn" onclick="logout()">üö™ Sair da Conta</button>
    </div>

    <!-- Navega√ß√£o injetada via JavaScript -->
    <div id="nav-container"></div>

    <script src="js/data.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/components.js"></script>
    <script>
        // Verificar autentica√ß√£o e injetar navega√ß√£o
        TheraFlowUI.checkAuth();
        TheraFlowComponents.injectNavigation('perfil');

        // Dados
        var profile = {};

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadProfile();
            loadStats();
        });

        function loadProfile() {
            profile = TheraFlowData.getProfile();
            
            // Header
            document.getElementById('userName').textContent = profile.nome || profile.displayName || 'Terapeuta';
            document.getElementById('userEmail').textContent = profile.email || 'email@exemplo.com';
            
            // Avatar
            var avatarEl = document.getElementById('userAvatar');
            if (profile.avatar) {
                avatarEl.textContent = profile.avatar;
            }
            
            // Informa√ß√µes
            var createdAt = profile.createdAt ? TheraFlowUI.formatDateBR(profile.createdAt) : 'Hoje';
            
            document.getElementById('infoContent').innerHTML = 
                '<div class="info-row">' +
                    '<span class="label">Nome</span>' +
                    '<span class="value">' + (profile.nome || profile.displayName || '-') + '</span>' +
                '</div>' +
                '<div class="info-row">' +
                    '<span class="label">Email</span>' +
                    '<span class="value">' + (profile.email || '-') + '</span>' +
                '</div>' +
                '<div class="info-row">' +
                    '<span class="label">Telefone</span>' +
                    '<span class="value">' + (profile.telefone || '-') + '</span>' +
                '</div>' +
                '<div class="info-row">' +
                    '<span class="label">Especialidade</span>' +
                    '<span class="value">' + (profile.especialidade || '-') + '</span>' +
                '</div>' +
                '<div class="info-row">' +
                    '<span class="label">Dura√ß√£o padr√£o</span>' +
                    '<span class="value">' + (profile.duracaoPadrao || 60) + ' min</span>' +
                '</div>' +
                '<div class="info-row">' +
                    '<span class="label">Cadastro</span>' +
                    '<span class="value">' + createdAt + '</span>' +
                '</div>';
        }

        function loadStats() {
            var clients = TheraFlowData.getClients();
            var sessions = TheraFlowData.getSessions();
            
            // Sess√µes do m√™s atual
            var now = new Date();
            var monthStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');
            var monthSessions = sessions.filter(function(s) {
                return s.data && s.data.indexOf(monthStr) === 0;
            });
            
            document.getElementById('statClients').textContent = clients.length;
            document.getElementById('statSessions').textContent = monthSessions.length;
            
            // Carregar limites do plano
            loadPlanLimits();
        }

        function loadPlanLimits() {
            var limits = TheraFlowData.checkPlanLimits();
            
            // Atualizar nome do plano
            var planNames = { free: 'Gratuito ‚ú®', pro: 'Pro üöÄ', premium: 'Premium üëë' };
            document.getElementById('planName').textContent = planNames[limits.plan] || planNames.free;
            
            // Atualizar features
            var features = {
                free: '‚úì At√© 5 clientes<br>‚úì Agenda completa<br>‚úì Controle financeiro b√°sico<br>‚úó Sem pacotes de sess√µes',
                pro: '‚úì At√© 50 clientes<br>‚úì Agenda completa<br>‚úì Controle financeiro<br>‚úì Pacotes de sess√µes',
                premium: '‚úì Clientes ilimitados<br>‚úì Agenda completa<br>‚úì Controle financeiro<br>‚úì Pacotes de sess√µes<br>‚úì Relat√≥rios avan√ßados'
            };
            document.getElementById('planFeatures').innerHTML = features[limits.plan] || features.free;
            
            // Atualizar barra de progresso
            document.getElementById('limitText').textContent = limits.clientCount + '/' + limits.clientLimit + ' clientes';
            document.getElementById('limitBar').style.width = Math.min(limits.usagePercent, 100) + '%';
            
            // Mudar cor se estiver perto do limite
            if (limits.usagePercent >= 80) {
                document.getElementById('limitBar').style.background = '#f59e0b';
            }
            if (limits.usagePercent >= 100) {
                document.getElementById('limitBar').style.background = '#ef4444';
            }
        }

        function showEditProfileModal() {
            var content = 
                '<form id="editProfileForm">' +
                    '<div class="form-group">' +
                        '<label>üë§ Nome</label>' +
                        '<input type="text" id="editName" value="' + (profile.nome || profile.displayName || '') + '" required>' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>üìß Email</label>' +
                        '<input type="email" id="editEmail" value="' + (profile.email || '') + '" required>' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>üì± Telefone</label>' +
                        '<input type="tel" id="editPhone" value="' + (profile.telefone || '') + '" placeholder="(00) 00000-0000">' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>üíÜ Especialidade</label>' +
                        '<select id="editSpecialty">' +
                            '<option value="Massoterapia"' + (profile.especialidade === 'Massoterapia' ? ' selected' : '') + '>Massoterapia</option>' +
                            '<option value="Reiki"' + (profile.especialidade === 'Reiki' ? ' selected' : '') + '>Reiki</option>' +
                            '<option value="Acupuntura"' + (profile.especialidade === 'Acupuntura' ? ' selected' : '') + '>Acupuntura</option>' +
                            '<option value="Quiropraxia"' + (profile.especialidade === 'Quiropraxia' ? ' selected' : '') + '>Quiropraxia</option>' +
                            '<option value="Terapias Hol√≠sticas"' + (profile.especialidade === 'Terapias Hol√≠sticas' ? ' selected' : '') + '>Terapias Hol√≠sticas</option>' +
                            '<option value="Fisioterapia"' + (profile.especialidade === 'Fisioterapia' ? ' selected' : '') + '>Fisioterapia</option>' +
                            '<option value="Est√©tica"' + (profile.especialidade === 'Est√©tica' ? ' selected' : '') + '>Est√©tica</option>' +
                        '</select>' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>‚è±Ô∏è Dura√ß√£o padr√£o da sess√£o (min)</label>' +
                        '<select id="editDuration">' +
                            '<option value="30"' + (profile.duracaoPadrao === 30 ? ' selected' : '') + '>30 minutos</option>' +
                            '<option value="45"' + (profile.duracaoPadrao === 45 ? ' selected' : '') + '>45 minutos</option>' +
                            '<option value="60"' + (profile.duracaoPadrao === 60 || !profile.duracaoPadrao ? ' selected' : '') + '>60 minutos</option>' +
                            '<option value="90"' + (profile.duracaoPadrao === 90 ? ' selected' : '') + '>90 minutos</option>' +
                            '<option value="120"' + (profile.duracaoPadrao === 120 ? ' selected' : '') + '>120 minutos</option>' +
                        '</select>' +
                    '</div>' +
                '</form>';
            
            TheraFlowUI.showModal({
                title: '‚úèÔ∏è Editar Perfil',
                content: content,
                buttons: [
                    { text: 'Cancelar', onClick: function() { TheraFlowUI.closeModal(); } },
                    { text: 'Salvar', primary: true, onClick: saveProfile }
                ]
            });
        }

        function saveProfile() {
            var nome = document.getElementById('editName').value;
            var email = document.getElementById('editEmail').value;
            var telefone = document.getElementById('editPhone').value;
            var especialidade = document.getElementById('editSpecialty').value;
            var duracaoPadrao = parseInt(document.getElementById('editDuration').value);
            
            if (!nome || !email) {
                TheraFlowUI.toast('Nome e email s√£o obrigat√≥rios', 'error');
                return;
            }
            
            profile.nome = nome;
            profile.displayName = nome;
            profile.email = email;
            profile.telefone = telefone;
            profile.especialidade = especialidade;
            profile.duracaoPadrao = duracaoPadrao;
            
            TheraFlowData.saveProfile(profile);
            
            TheraFlowUI.closeModal();
            loadProfile();
            TheraFlowUI.toast('Perfil atualizado!', 'success');
        }

        function showServicesModal() {
            var services = profile.servicos || ['Massagem Relaxante', 'Massagem Desportiva', 'Drenagem Linf√°tica'];
            
            var servicesList = services.map(function(s, i) {
                return '<div class="service-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">' +
                    '<span class="service-name" style="font-weight: 500;">' + s + '</span>' +
                    '<div style="display: flex; gap: 8px;">' +
                        '<button onclick="editService(' + i + ')" style="background: none; border: none; cursor: pointer; font-size: 1.1em;" title="Editar">‚úèÔ∏è</button>' +
                        '<button onclick="removeService(' + i + ')" style="background: none; border: none; cursor: pointer; font-size: 1.1em; color: #ef4444;" title="Excluir">üóëÔ∏è</button>' +
                    '</div>' +
                '</div>';
            }).join('');
            
            if (services.length === 0) {
                servicesList = '<div style="text-align: center; padding: 30px; color: #999;"><p>Nenhum servi√ßo cadastrado</p></div>';
            }
            
            var content = 
                '<p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Gerencie os tipos de atendimento que voc√™ oferece:</p>' +
                '<div class="service-list" style="max-height: 300px; overflow-y: auto;">' +
                    servicesList +
                '</div>' +
                '<button class="add-service-btn" onclick="addServicePrompt()" style="width: 100%; padding: 12px; background: #f0f0f0; border: 2px dashed #ccc; border-radius: 8px; color: #666; cursor: pointer; margin-top: 15px; font-size: 1em;">+ Adicionar Novo Servi√ßo</button>';
            
            TheraFlowUI.showModal({
                title: 'üíÜ Meus Servi√ßos (Tipos de Sess√£o)',
                content: content,
                buttons: [
                    { text: 'Fechar', onClick: function() { TheraFlowUI.closeModal(); } }
                ]
            });
        }

        function editService(index) {
            var services = profile.servicos || [];
            var currentName = services[index] || '';
            
            TheraFlowUI.closeModal();
            
            var content = 
                '<div class="form-group">' +
                    '<label>Nome do Servi√ßo</label>' +
                    '<input type="text" id="editServiceName" value="' + currentName + '" placeholder="Ex: Massagem Relaxante">' +
                '</div>';
            
            TheraFlowUI.showModal({
                title: '‚úèÔ∏è Editar Servi√ßo',
                content: content,
                buttons: [
                    { text: 'Cancelar', onClick: function() { TheraFlowUI.closeModal(); showServicesModal(); } },
                    { text: 'Salvar', primary: true, onClick: function() {
                        var newName = document.getElementById('editServiceName').value.trim();
                        if (!newName) {
                            TheraFlowUI.toast('Digite o nome do servi√ßo', 'error');
                            return;
                        }
                        
                        profile.servicos[index] = newName;
                        TheraFlowData.saveProfile(profile);
                        
                        TheraFlowUI.closeModal();
                        TheraFlowUI.toast('Servi√ßo atualizado!', 'success');
                        showServicesModal();
                    }}
                ]
            });
        }

        function addServicePrompt() {
            TheraFlowUI.closeModal();
            
            var content = 
                '<div class="form-group">' +
                    '<label>Nome do Servi√ßo</label>' +
                    '<input type="text" id="newServiceName" placeholder="Ex: Massagem Relaxante">' +
                '</div>' +
                '<p style="color: #666; font-size: 0.85em; margin-top: 10px;">üí° Dica: Adicione todos os tipos de atendimento que voc√™ oferece.</p>';
            
            TheraFlowUI.showModal({
                title: '‚ûï Novo Servi√ßo',
                content: content,
                buttons: [
                    { text: 'Cancelar', onClick: function() { TheraFlowUI.closeModal(); showServicesModal(); } },
                    { text: 'Adicionar', primary: true, onClick: function() {
                        var name = document.getElementById('newServiceName').value.trim();
                        if (!name) {
                            TheraFlowUI.toast('Digite o nome do servi√ßo', 'error');
                            return;
                        }
                        
                        if (!profile.servicos) profile.servicos = [];
                        profile.servicos.push(name);
                        TheraFlowData.saveProfile(profile);
                        
                        TheraFlowUI.closeModal();
                        TheraFlowUI.toast('Servi√ßo adicionado!', 'success');
                        showServicesModal();
                    }}
                ]
            });
        }

        function removeService(index) {
            var serviceName = profile.servicos[index];
            TheraFlowUI.confirm('Deseja excluir o servi√ßo "' + serviceName + '"?', function() {
                profile.servicos.splice(index, 1);
                TheraFlowData.saveProfile(profile);
                TheraFlowUI.toast('Servi√ßo removido', 'success');
                showServicesModal();
            }, function() {
                // Ao cancelar, reabrir modal de servi√ßos
            });
        }

        function showNotificationsModal() {
            var prefs = profile.notifications || { reminder: true, summary: false };
            
            var content = 
                '<div style="padding: 10px 0;">' +
                    '<div class="menu-item" style="cursor: default;">' +
                        '<div class="left">' +
                            '<span class="icon">‚è∞</span>' +
                            '<span class="text">Lembrete de atendimento</span>' +
                        '</div>' +
                        '<span style="color: ' + (prefs.reminder ? '#059669' : '#999') + ';">' + (prefs.reminder ? '‚úÖ Ativo' : '‚ùå Inativo') + '</span>' +
                    '</div>' +
                    '<div class="menu-item" style="cursor: default;">' +
                        '<div class="left">' +
                            '<span class="icon">üìä</span>' +
                            '<span class="text">Resumo semanal</span>' +
                        '</div>' +
                        '<span style="color: ' + (prefs.summary ? '#059669' : '#999') + ';">' + (prefs.summary ? '‚úÖ Ativo' : '‚ùå Inativo') + '</span>' +
                    '</div>' +
                '</div>' +
                '<p style="color: #666; font-size: 0.9em; text-align: center; margin-top: 15px;">üì± Notifica√ß√µes push dispon√≠veis no app mobile</p>';
            
            TheraFlowUI.showModal({
                title: 'üîî Notifica√ß√µes',
                content: content,
                buttons: [
                    { text: 'Fechar', onClick: function() { TheraFlowUI.closeModal(); } }
                ]
            });
        }

        function showBackupModal() {
            var clients = TheraFlowData.getClients();
            var sessions = TheraFlowData.getSessions();
            
            var content = 
                '<div style="text-align: center; padding: 20px 0;">' +
                    '<div style="font-size: 4em; margin-bottom: 20px;">ÔøΩ</div>' +
                    '<div style="background: #d1fae5; color: #059669; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 600;">' +
                        '‚úÖ Seus dados est√£o seguros na nuvem' +
                    '</div>' +
                    '<p style="margin-bottom: 20px; color: #666;">Backup autom√°tico ativado. Seus dados s√£o sincronizados em tempo real.</p>' +
                    '<div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: left;">' +
                        '<div style="margin-bottom: 8px;">üë• <strong>' + clients.length + '</strong> clientes salvos</div>' +
                        '<div style="margin-bottom: 8px;">üìÖ <strong>' + sessions.length + '</strong> sess√µes registradas</div>' +
                        '<div style="margin-bottom: 8px;">‚òÅÔ∏è <strong>Backup autom√°tico</strong> ativado</div>' +
                        '<div>üîê <strong>Criptografia</strong> de ponta a ponta</div>' +
                    '</div>' +
                    '<p style="margin-top: 15px; font-size: 0.85em; color: #999;">√öltimo backup: agora mesmo</p>' +
                '</div>';
            
            TheraFlowUI.showModal({
                title: 'üíæ Backup e Seguran√ßa',
                content: content,
                buttons: [
                    { text: 'Fechar', onClick: function() { TheraFlowUI.closeModal(); } },
                    { text: 'Exportar JSON', primary: true, onClick: exportData }
                ]
            });
        }

        function exportData() {
            var data = {
                profile: TheraFlowData.getProfile(),
                clients: TheraFlowData.getClients(),
                sessions: TheraFlowData.getSessions(),
                exportDate: new Date().toISOString()
            };
            
            var blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'theraflow_backup_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            TheraFlowUI.toast('Backup exportado!', 'success');
        }

        function showAboutModal() {
            var content = 
                '<div style="text-align: center; padding: 20px 0;">' +
                    '<div style="font-size: 4em; margin-bottom: 15px;">üíÜ‚Äç‚ôÄÔ∏è</div>' +
                    '<h3 style="margin-bottom: 5px;">TheraFlow</h3>' +
                    '<p style="color: #666; margin-bottom: 20px;">Vers√£o Demo 1.0.0</p>' +
                    '<p style="font-size: 0.9em; color: #666; line-height: 1.6;">' +
                        'Gest√£o completa para terapeutas hol√≠sticos.<br>' +
                        'Agende, gerencie clientes e controle suas finan√ßas em um s√≥ lugar.' +
                    '</p>' +
                    '<div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">' +
                        '<p style="font-size: 0.85em; color: #999;">¬© 2024 TheraFlow</p>' +
                        '<p style="font-size: 0.85em; color: #999;">Desenvolvido com üíú</p>' +
                    '</div>' +
                '</div>';
            
            TheraFlowUI.showModal({
                title: '‚ÑπÔ∏è Sobre o App',
                content: content,
                buttons: [
                    { text: 'Fechar', onClick: function() { TheraFlowUI.closeModal(); } }
                ]
            });
        }

        function showUpgradeModal() {
            showPlansModal();
        }

        function showPlansModal() {
            var limits = TheraFlowData.checkPlanLimits();
            var lostValue = limits.plan === 'free' ? 'R$ 500+' : 'R$ 200+';
            
            var content = 
                '<div style="padding: 10px 0;">' +
                    // Mensagem de valor perdido
                    '<div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 20px;">' +
                        '<div style="font-size: 1.1em; font-weight: bold;">üí∏ Voc√™ est√° perdendo ' + lostValue + ' por m√™s sem o Pro</div>' +
                        '<div style="font-size: 0.9em; opacity: 0.9; margin-top: 5px;">Pacotes de sess√µes aumentam reten√ß√£o e receita</div>' +
                    '</div>' +
                    
                    // Tabela de planos
                    '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">' +
                        // Free
                        '<div style="background: ' + (limits.plan === 'free' ? '#f0f0f0' : '#f8f9fa') + '; padding: 20px; border-radius: 12px; text-align: center; border: 2px solid ' + (limits.plan === 'free' ? '#667eea' : 'transparent') + ';">' +
                            '<div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">GR√ÅTIS</div>' +
                            '<div style="font-size: 1.3em; font-weight: bold; color: #333; margin-bottom: 15px;">Free</div>' +
                            '<div style="font-size: 0.85em; color: #666; line-height: 1.8;">' +
                                '‚úì 5 clientes<br>' +
                                '‚úì Agenda<br>' +
                                '‚úó Pacotes<br>' +
                                '‚úó Relat√≥rios' +
                            '</div>' +
                            (limits.plan === 'free' ? '<div style="background: #667eea; color: white; padding: 8px; border-radius: 6px; margin-top: 15px; font-size: 0.85em;">Atual</div>' : '') +
                        '</div>' +
                        
                        // Pro
                        '<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; transform: scale(1.05); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">' +
                            '<div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">‚≠ê RECOMENDADO</div>' +
                            '<div style="font-size: 1.3em; font-weight: bold; margin-bottom: 5px;">Pro</div>' +
                            '<div style="font-size: 1.5em; font-weight: bold;">R$ 29<span style="font-size: 0.5em;">/m√™s</span></div>' +
                            '<div style="font-size: 0.85em; line-height: 1.8; margin-top: 15px;">' +
                                '‚úì 50 clientes<br>' +
                                '‚úì Agenda<br>' +
                                '‚úì Pacotes<br>' +
                                '‚úì Suporte' +
                            '</div>' +
                            '<button onclick="selectPlan(\'pro\')" style="background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 6px; margin-top: 15px; font-weight: bold; cursor: pointer; width: 100%;">Escolher Pro</button>' +
                        '</div>' +
                        
                        // Premium
                        '<div style="background: #f8f9fa; padding: 20px; border-radius: 12px; text-align: center;">' +
                            '<div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">üëë COMPLETO</div>' +
                            '<div style="font-size: 1.3em; font-weight: bold; color: #333; margin-bottom: 5px;">Premium</div>' +
                            '<div style="font-size: 1.5em; font-weight: bold; color: #333;">R$ 49<span style="font-size: 0.5em; color: #666;">/m√™s</span></div>' +
                            '<div style="font-size: 0.85em; color: #666; line-height: 1.8; margin-top: 15px;">' +
                                '‚úì Ilimitado<br>' +
                                '‚úì Pacotes<br>' +
                                '‚úì Relat√≥rios<br>' +
                                '‚úì Prioridade' +
                            '</div>' +
                            '<button onclick="selectPlan(\'premium\')" style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 6px; margin-top: 15px; font-weight: bold; cursor: pointer; width: 100%;">Escolher</button>' +
                        '</div>' +
                    '</div>' +
                    
                    // Compara√ß√£o detalhada
                    '<div style="margin-top: 25px; background: #f8f9fa; padding: 15px; border-radius: 10px;">' +
                        '<h4 style="margin-bottom: 15px; text-align: center;">üìä Comparativo Completo</h4>' +
                        '<table style="width: 100%; font-size: 0.9em; border-collapse: collapse;">' +
                            '<tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 8px;"><strong>Funcionalidade</strong></td><td style="text-align: center; padding: 8px;"><strong>Free</strong></td><td style="text-align: center; padding: 8px;"><strong>Pro</strong></td><td style="text-align: center; padding: 8px;"><strong>Premium</strong></td></tr>' +
                            '<tr style="border-bottom: 1px solid #f0f0f0;"><td style="padding: 8px;">Clientes</td><td style="text-align: center; padding: 8px;">5</td><td style="text-align: center; padding: 8px;">50</td><td style="text-align: center; padding: 8px;">‚àû</td></tr>' +
                            '<tr style="border-bottom: 1px solid #f0f0f0;"><td style="padding: 8px;">Pacotes de Sess√µes</td><td style="text-align: center; padding: 8px;">‚ùå</td><td style="text-align: center; padding: 8px;">‚úÖ</td><td style="text-align: center; padding: 8px;">‚úÖ</td></tr>' +
                            '<tr style="border-bottom: 1px solid #f0f0f0;"><td style="padding: 8px;">Relat√≥rios PDF/CSV</td><td style="text-align: center; padding: 8px;">‚ùå</td><td style="text-align: center; padding: 8px;">‚úÖ</td><td style="text-align: center; padding: 8px;">‚úÖ</td></tr>' +
                            '<tr><td style="padding: 8px;">Backup na Nuvem</td><td style="text-align: center; padding: 8px;">‚ùå</td><td style="text-align: center; padding: 8px;">‚úÖ</td><td style="text-align: center; padding: 8px;">‚úÖ</td></tr>' +
                        '</table>' +
                    '</div>' +
                '</div>';
            
            TheraFlowUI.showModal({
                title: 'üöÄ Planos e Benef√≠cios',
                content: content,
                buttons: [
                    { text: 'Fechar', onClick: function() { TheraFlowUI.closeModal(); } }
                ]
            });
        }

        function selectPlan(planType) {
            TheraFlowUI.closeModal();
            
            // Em produ√ß√£o, isso redirecionaria para pagamento
            setTimeout(function() {
                TheraFlowUI.showModal({
                    title: 'üéâ Upgrade em breve!',
                    content: '<div style="text-align: center; padding: 20px;"><div style="font-size: 4em; margin-bottom: 15px;">üöÄ</div><p>O sistema de pagamentos est√° sendo finalizado.</p><p style="color: #666; margin-top: 10px;">Obrigado pelo interesse no plano ' + planType.toUpperCase() + '!</p></div>',
                    buttons: [
                        { text: 'OK', primary: true, onClick: function() { TheraFlowUI.closeModal(); } }
                    ]
                });
            }, 200);
        }

        function resetData() {
            TheraFlowUI.confirm(
                '‚ö†Ô∏è Limpar Todos os Dados',
                'Esta a√ß√£o ir√° apagar TODOS os seus dados: clientes, sess√µes, configura√ß√µes. Esta a√ß√£o N√ÉO pode ser desfeita!',
                function() {
                    TheraFlowData.clearAll();
                    TheraFlowUI.toast('Dados limpos! Redirecionando...', 'info');
                    setTimeout(function() {
                        window.location.href = 'index.html';
                    }, 1500);
                }
            );
        }

        function logout() {
            TheraFlowUI.confirm(
                'üö™ Sair da Conta',
                'Deseja realmente sair? Seus dados permanecer√£o salvos.',
                function() {
                    TheraFlowData.logout();
                    window.location.href = 'index.html';
                }
            );
        }
    </script>
</body>
</html>
